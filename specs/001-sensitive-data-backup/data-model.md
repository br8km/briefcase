# Data Model: Sensitive Data Backup

**Date**: 2026-01-19
**Feature**: Sensitive Data Backup

## Overview

The application manages backup operations for personal sensitive data, including Firefox profiles and custom folders. Data is encrypted locally and optionally synced to remote storage providers.

## Key Entities

### Config
Represents the application configuration loaded from TOML file.

**Fields**:
- general: GeneralConfig (password_hint, password_key, max_retention)
- firefox_source: FirefoxSource (enabled, dir, frequency)
- folder_source: FolderSource (enabled, dir, frequency)
- remote_configs: Vec<RemoteConfig> (dropbox, onedrive, icloud, sftp)
- last_backup: Option<DateTime<Local>> (timestamp of last successful backup)

**Relationships**:
- Contains multiple RemoteConfig instances
- Referenced by BackupOperation for settings

**Validation Rules**:
- Paths must exist and be readable
- Frequencies must be 'hourly', 'daily', 'weekly'
- Max retention 0-10
- Password key must be valid hash

**State Transitions**: Immutable during runtime, reloaded on config changes.

### BackupFile
Represents an encrypted backup archive.

**Fields**:
- path: PathBuf (local storage location)
- datetime: DateTime<Local> (creation timestamp)
- size: u64 (file size in bytes)
- source_type: SourceType (Firefox or Folder)
- hash: String (SHA256 of encrypted content for integrity)

**Relationships**:
- Created by BackupOperation
- Synced to RemoteConfig destinations

**Validation Rules**:
- Path must be valid file
- Size <= 32MB
- Datetime in past
- Hash matches content

**State Transitions**: Created → Synced → Archived/Deleted

### LogEntry
Represents a structured log record.

**Fields**:
- timestamp: DateTime<Local>
- level: LogLevel (Error, Warn, Info, Debug, Trace)
- message: String
- context: HashMap<String, Value> (operation_id, file_path, etc.)
- component: String (backup, sync, crypto)

**Relationships**:
- Generated by all operations
- Stored in monthly rotating log files named `<%Y-%m>.log`

**Validation Rules**:
- Level valid enum value
- Message non-empty
- Context keys valid identifiers

**State Transitions**: Created → Written to file → Rotated/Archived

### TempDir
Represents temporary working directory for backup staging.

**Fields**:
- path: PathBuf
- created_at: DateTime<Local>
- size_limit: u64 (max allowed size)

**Relationships**:
- Used by BackupOperation for staging
- Cleaned after operation completion

**Validation Rules**:
- Path writable
- Size limit <= 32MB
- Auto-cleanup on drop

**State Transitions**: Created → Populated → Cleaned

### RemoteConfig
Represents configuration for remote storage provider.

**Fields**:
- provider: ProviderType (Dropbox, OneDrive, iCloud, SFTP)
- enabled: bool
- credentials: ProviderCredentials (varies by provider)
- frequency: Option<Frequency> (sync frequency if different from source)

**Relationships**:
- Belongs to Config
- Target for SyncOperation

**Validation Rules**:
- Provider valid enum
- Credentials complete for enabled providers
- Frequency optional, defaults to source frequency

**State Transitions**: Configured → Enabled/Disabled → Synced

## Domain Rules

- All data operations must validate password key before proceeding
- Backup files follow naming pattern: {source}_{datetime}.7z
- Retention policy enforced by deleting oldest files beyond max_retention
- Remote sync only occurs after successful local backup
- Firefox backup handles locked profile files gracefully
- All operations logged with structured data
- Encryption uses unique keys per backup session